<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8">
      <meta name="format-detection" content="telephone=no">
      <meta name="msapplication-tap-highlight" content="no">
      <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
      <link rel="stylesheet" href="css/fontawesome.css">
      <link rel="stylesheet" href="css/solid.css">
      <link rel="stylesheet" href="css/bootstrap.css">
      <link rel="stylesheet" href="css/index.css">
      <script src="cordova.js"></script>
  </head>
  <body class="bg-light">
    <!-- Barra superior -->
    <div class="sticky-top bg-primary d-flex p-2">
      <div class="col-6">
        <p class="m-2 h4" id="calendario"></p>
      </div>
      <div class="text-end col-6">
        <i class="fa-solid fa-calendar m-2 h4"></i>
        <i class="fa-solid fa-gear m-2 h4"></i>
      </div>
    </div>
    <!-- Fin barra superior -->

    <!-- Modal agregar series -->
    <div class="modal fade" id="modalCSet" tabindex="-1" aria-labelledby="modalCSetLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <div>
                <h1 id="titulo" class="modal-title fs-5"></h1>
                <p id="subtitulo" class="modal-title fst-italic"></p>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="input-group flex-nowrap mb-3">
                <span class="input-group-text">KG</span>
                <input type="number" class="form-control" id="valor1">
            </div>
            <div class="input-group flex-nowrap mb-3">
                <span class="input-group-text">REP</span>
                <input type="number" class="form-control" id="valor2">
            </div>
            <div class="btn-group-sm text-center form-group">
                <input type="radio" class="btn-check btn-calentamiento" name="dificultad" id="calentamiento" value="1">
                <label class="btn btn-calentamiento" for="calentamiento">Calentamiento</label>
                <input type="radio" class="btn-check btn-facil" name="dificultad" id="facil" value="2">
                <label class="btn btn-facil" for="facil">Fácil</label>
                <input type="radio" class="btn-check btn-normal" name="dificultad" id="normal" value="3">
                <label class="btn btn-normal" for="normal">Normal</label>
                <input type="radio" class="btn-check btn-dificil" name="dificultad" id="dificil" value="4">
                <label class="btn btn-dificil" for="dificil">Difícil</label>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" id="btn-crearSerie" data-bs-dismiss="modal">Guardar</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Fin modal -->

    <!-- Modal editar serie -->
    <div class="modal fade" id="modalUSet" tabindex="-1" aria-labelledby="modalUSetLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <div>
                        <h1 id="titulo" class="modal-title fs-5"></h1>
                        <p id="subtitulo" class="modal-title fst-italic"></p>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="input-group flex-nowrap mb-3">
                        <span class="input-group-text">KG</span>
                        <input type="number" class="form-control" id="valor1E">
                    </div>
                    <div class="input-group flex-nowrap mb-3">
                        <span class="input-group-text">REP</span>
                        <input type="number" class="form-control" id="valor2E">
                    </div>
                    <div class="btn-group-sm text-center form-group">
                        <input type="radio" class="btn-check btn-calentamiento" name="dificultadE" id="calentamientoE" value="1">
                        <label class="btn btn-calentamiento" for="calentamientoE">Calentamiento</label>
                        <input type="radio" class="btn-check btn-facil" name="dificultadE" id="facilE" value="2">
                        <label class="btn btn-facil" for="facilE">Fácil</label>
                        <input type="radio" class="btn-check btn-normal" name="dificultadE" id="normalE" value="3">
                        <label class="btn btn-normal" for="normalE">Normal</label>
                        <input type="radio" class="btn-check btn-dificil" name="dificultadE" id="dificilE" value="4">
                        <label class="btn btn-dificil" for="dificilE">Difícil</label>
                    </div>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-primary"><i class="fas fa-trash-can"></i></button>
                    <div>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="btn-editarSerie" onclick="editarSerie()" data-bs-dismiss="modal">Actualizar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Fin modal -->

    <!-- Entrenamientos -->
    <div id="entrenamientos" class="mb-5"></div>
    <!-- Fin de entrenamientos -->

    <!-- Barra inferior -->
    <div class="align-items-center mh-45px fixed-bottom bg-primary p-2 d-flex justify-content-around" w3-include-html="footer.html"></div>
    <script src="js/footer.js"></script>
    <script>includeHTML();</script>
    <!-- Fin  barra inferior -->
  
    <script src="js/bootstrap.js"></script>
    <script src="js/bootstrap.bundle.js"></script>
    <script src="js/db.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script>
        document.addEventListener('deviceready', async function() {
            const db = conexion();
            await crearTablas(db);

            // Calendario
            let calendario = await getCalendario(db);
            let id_calendario = calendario.rows.item(0).ID;
            let nombre_calendario = calendario.rows.item(0).nombre;
            let color_calendario = calendario.rows.item(0).color;
            $("#calendario").text(nombre_calendario);
            const modalCSet = document.getElementById('modalCSet')
            modalCSet.addEventListener('show.bs.modal', async event => {
                let boton = event.relatedTarget
                let nset = boton.getAttribute('data-bs-nset')
                let id_entrenamiento = boton.getAttribute('data-bs-entrenamiento')
                let rs_entrenamiento = await getEntrenamiento(db,id_entrenamiento);
                let entrenamiento = rs_entrenamiento.rows.item(0)
                let ejercicio = await getEjercicios(db,`WHERE ID = ${entrenamiento.ejercicio}`);
                let titulo = modalCSet.querySelector('#titulo')
                let subtitulo = modalCSet.querySelector('#subtitulo')
                titulo.textContent = 'Set Nº ' + nset
                subtitulo.textContent = ejercicio.rows.item(0).nombre;
                let guardar = modalCSet.querySelector('#btn-crearSerie')
                guardar.setAttribute('onclick',`crearSet(${entrenamiento.ID},${nset})`)
                $("#valor1").val("")
                $("#valor2").val("")
                $("input[name='dificultad']:checked").attr("checked",false)
            })
            const modalUSet = document.getElementById('modalUSet')
            modalUSet.addEventListener('show.bs.modal', async event => {
                let boton = event.relatedTarget
                let nset = boton.getAttribute('data-bs-nset')
                let id_ejercicio = boton.getAttribute('data-bs-entrenamiento')
                let ejercicio = await getEjercicios(db,`WHERE ID = ${id_ejercicio}`);
                let titulo = modalUSet.querySelector('#titulo')
                let subtitulo = modalUSet.querySelector('#subtitulo')
                titulo.textContent = 'Edición set Nº ' + nset
                subtitulo.textContent = ejercicio.rows.item(0).nombre;
            })

            const entrenamientos = await getEntrenamientos(db,id_calendario,"20/05/2023");
            if(entrenamientos.rows.length > 0){
                for (let i = 0; i < entrenamientos.rows.length; i++) {
                    let entrenamiento = entrenamientos.rows.item(i);
                    let ejercicio = await getEjercicios(db,`WHERE ID = ${entrenamiento.ejercicio}`);
                    ejercicio = ejercicio.rows.item(0);
                    let div1 = document.createElement('div');
                    div1.classList.add('px-4', 'my-2');
                    let div2 = document.createElement('div');
                    div2.classList.add('bg-white', 'rounded', 'shadow-sm', 'p-3', 'row');
                    let div3 = document.createElement('div');
                    div3.classList.add('col-4');
                    let img = document.createElement('img');
                    img.classList.add('rounded-circle', 'shadow', 'img-fluid');
                    img.src = ejercicio.imagen;
                    div3.appendChild(img);
                    div2.appendChild(div3);
                    let div4 = document.createElement('div');
                    div4.classList.add('col-8');
                    let div5 = document.createElement('div');
                    div5.classList.add('row');
                    let div6 = document.createElement('div');
                    div6.classList.add('col-10');
                    let p = document.createElement('p');
                    let strong = document.createElement('strong');
                    let u = document.createElement('u');
                    u.textContent = ejercicio.nombre;
                    strong.appendChild(u);
                    p.appendChild(strong);
                    div6.appendChild(p);
                    div5.appendChild(div6);
                    let div7 = document.createElement('div');
                    div7.classList.add('col-2');
                    let icono = document.createElement('i');
                    icono.classList.add('fa-solid', 'fa-ellipsis-vertical');
                    div7.appendChild(icono);
                    div5.appendChild(div7);
                    div4.appendChild(div5);
                    let div8 = document.createElement('div');
                    div8.id = 'series';
                    div8.classList.add('row', 'text-center');
                    const series = await getSeries(db,entrenamiento.ID);
                    for (let j = 0; j < series.rows.length; j++) {
                        let serie = series.rows.item(j);
                        let div9 = document.createElement('div');
                        div9.setAttribute('data-bs-toggle', 'modal');
                        div9.setAttribute('data-bs-target', '#modalUSet');
                        div9.setAttribute('data-bs-entrenamiento', entrenamiento.ID);
                        div9.setAttribute('data-bs-nset', serie.numero);
                        div9.classList.add('col-3', 'd-flex', 'flex-column', 'justify-content-center');
                        let div10 = document.createElement('div');
                        div10.classList.add('py-1', 'h-25', 'rounded-pill');
                        if(serie.dificultad == 1)
                            div10.classList.add('bg-calentamiento');
                        if(serie.dificultad == 2)
                            div10.classList.add('bg-facil');
                        if(serie.dificultad == 3)
                            div10.classList.add('bg-normal');
                        if(serie.dificultad == 4)
                            div10.classList.add('bg-dificil');
                        let p1 = document.createElement('p');
                        p1.textContent = serie.valor1;
                        let p2 = document.createElement('p');
                        p2.textContent = serie.valor2;
                        div9.appendChild(div10);
                        div9.appendChild(p1);
                        div9.appendChild(p2);
                        div8.appendChild(div9);
                    }
                    let div11 = document.createElement('div');
                    div11.classList.add('col-3', 'd-flex', 'flex-column', 'justify-content-center');
                    let button = document.createElement('button');
                    button.setAttribute('data-bs-toggle', 'modal');
                    button.setAttribute('data-bs-target', '#modalCSet');
                    button.setAttribute('data-bs-entrenamiento', entrenamiento.ID);
                    button.setAttribute('data-bs-nset', series.rows.length+1);
                    button.classList.add('btn');
                    let icon = document.createElement('i');
                    icon.classList.add('fas', 'fa-plus');
                    button.appendChild(icon);
                    div11.appendChild(button);
                    div8.appendChild(div11);
                    div4.appendChild(div8);
                    div2.appendChild(div4);
                    div1.appendChild(div2);
                    document.getElementById("entrenamientos").appendChild(div1);
                }
            }
            else{
                let h1 = document.createElement('h1');
                h1.textContent = "No hay entrenamientos en la fecha seleccionada";
                h1.classList.add('text-center');
                document.getElementById("entrenamientos").appendChild(h1);
            }
        })
        function crearSet(entrenamiento,numero){
            let valor1 = $("#valor1").val()
            let valor2 = $("#valor2").val()
            let dificultad = $("input[name='dificultad']:checked").val()
            console.log("Insertamos la serie "+numero+" en el entrenamiento "+entrenamiento);
            console.log("KGS: " + valor1)
            console.log("Repes: " + valor2)
            console.log("Dificultad: " + dificultad)
        }
        function editarSet(entrenamiento,numero){
            let valor1 = $("#valor1E").val()
            let valor2 = $("#valor2E").val()
            let dificultad = $("input[name='dificultadE']:checked").val()
            console.log("Editamos la serie "+numero+" en el entrenamiento "+entrenamiento);
            console.log("KGS: " + valor1)
            console.log("Repes: " + valor2)
            console.log("Dificultad: " + dificultad)
        }
    </script>
  </body>
</html>